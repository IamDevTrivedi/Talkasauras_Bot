name: talkasauras-dev

services:
    bot:
        build:
            context: .
            dockerfile: Dockerfile.dev
        container_name: talkasauras-dev-bot
        restart: unless-stopped
        ports:
            - "5000:5000"
            - "51212:51212"
        environment:
            - NODE_ENV=development
        env_file:
            - .env.development
        volumes:
            - .:/app
            - /app/node_modules
        depends_on:
            postgres:
                condition: service_healthy
            redis:
                condition: service_healthy
        sysctls:
            - net.ipv6.conf.all.disable_ipv6=1

    redis:
        image: redis:8-alpine
        container_name: talkasauras-dev-redis
        restart: unless-stopped
        volumes:
            - redis-data:/data
        healthcheck:
            test: ["CMD", "redis-cli", "ping"]
            interval: 5s
            timeout: 3s
            retries: 5
            start_period: 5s

    redis-commander:
        image: rediscommander/redis-commander:latest
        container_name: talkasauras-dev-redis-ui
        restart: unless-stopped
        ports:
            - "8081:8081"
        environment:
            - REDIS_HOSTS=local:redis:6379
        depends_on:
            redis:
                condition: service_healthy

    postgres:
        image: postgres:18-alpine
        container_name: talkasauras-dev-postgres
        restart: unless-stopped
        env_file:
            - .env.development
        volumes:
            - postgres-data:/var/lib/postgresql/data
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U $$POSTGRES_USER"]
            interval: 5s
            timeout: 5s
            retries: 5
            start_period: 10s

    ollama:
        image: ollama/ollama:latest
        container_name: talkasauras-dev-ollama
        restart: unless-stopped
        ports:
            - "5025:11434"
        volumes:
            - ollama-data:/root/.ollama

volumes:
    redis-data:
    postgres-data:
    ollama-data:
